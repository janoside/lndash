- chan = channel;

if (chan.chan_id)
	- chan.channel_id = chan.chan_id;
	- var parsedChannelId = utils.parseChannelId(chan.channel_id);

// specific to /node
if (unsharedChannels && unsharedChannels.includes(chan)) 
	- var isUnshared = true

if (localChannels && localChannels.byId && localChannels.byId[chan.channel_id] && !isUnshared)
	- var localChannel = localChannels.byId[chan.channel_id];

- let card_node_pubkey = null;
if (chan.remote_pubkey)
	- card_node_pubkey = chan.remote_pubkey;
else if (chan.channel && chan.channel.remote_node_pub)
	- card_node_pubkey = chan.channel.remote_node_pub;

- const channelDescription = fullNetworkDescription.parsedChannelIds[chan.channel_id];



tr.word-wrap
	th.fit.text-start.fw-light #{channelTableIndex.toLocaleString()}


	td.fit
		if (localChannel)
			span.me-2
				if (chan.active || localChannel.active)
					span(title="Active", data-bs-toggle="tooltip")
						i.fas.fa-circle.fa-sm.text-success

				else if (chan.channel_id)
					if (chan.close_type)
						span(title=`Closed (${chan.close_type})`, data-bs-toggle="tooltip")
							i.fas.fa-xmark.fa-sm.text-danger
					else
						span(title="Inactive", data-bs-toggle="tooltip")
							i.fas.fa-circle.fa-sm(style="color:var(--bs-gray-500)")

				else
					if (pendingOpenChannels.includes(chan))
						span(title="Opening", data-bs-toggle="tooltip")
							i.fas.fa-circle.fa-sm.text-orange
					if (pendingCloseChannels.includes(chan))
						span(title="Closing", data-bs-toggle="tooltip")
							i.fas.fa-circle.fa-sm.text-danger
					if (pendingForceCloseChannels.includes(chan))
						span(title="Force Closing", data-bs-toggle="tooltip")
							i.fas.fa-circle.fa-sm.text-danger
					if (waitingCloseChannels.includes(chan))
						span(title="Waiting to Close", data-bs-toggle="tooltip")
							i.fas.fa-circle.fa-sm.text-warning

			if (chan.channel_id)
				+channelId(chan.channel_id, localChannel.active || (chan.channel_id && !chan.close_type))
			else if (chan.closing_txid)
				+btcTxid(chan.closing_txid, 12)
			else if (pendingOpenChannels.includes(chan))
				- const [txid, output_index] = chan.channel.channel_point.split(':')
				+btcTxid(txid, 12)
				span.ms-1 [#{output_index}]
				
		else
			+channelId(chan.channel_id, true)


	if (localChannel) 
		td.chan-flags
			div
				if (localChannel.private)
					+pillBadgeSuccess
						span.me-1 Private
						i.fas.fa-lock
				else
					+pillBadgeInfo
						span.me-1 Public
						i.fas.fa-eye

				if (localChannel.initiator)
					+pillBadgeInfo
						span(title="You created this channel", data-bs-toggle="tooltip")
							span.me-1 Outbound
							i.fas.fa-arrow-up
				else
					+pillBadgeSuccess
						span(title="Your channel partner created this channel", data-bs-toggle="tooltip")
							span.me-1 Inbound
							i.fas.fa-arrow-down
		
		if (card_node_pubkey)
			td.fit
				+nodeCard(card_node_pubkey, {style: "compact"})
	else
		td.fit
			+nodeCard(chan.node1_pub, {style:"compact"})
		td.fit
			+nodeCard(chan.node2_pub, {style:"compact"})

	if (localChannel)
		td
			- let localBalance = null;
			- let remoteBalance = null;
			if (localChannel.channel)
				- localBalance = new Decimal(localChannel.channel.local_balance || 0);
				- remoteBalance = new Decimal(localChannel.channel.remote_balance || 0);
			else
				- localBalance = new Decimal(localChannel.local_balance || 0);
				- remoteBalance = new Decimal(localChannel.remote_balance || 0);


			if (localBalance != null)
				+progressBar([localBalance, remoteBalance], ["text-bg-primary", "text-bg-info"], "6px", false)

				.d-flex.justify-content-between
					.text-start
						span.fs-90
							+btcValue(localBalance)

					.text-end
						span.fs-90
							+btcValue(remoteBalance)

			else
				.text-end -

		td
			- let valueReceived = null;
			- let valueSent = null;

			if (localChannel != null)
				- valueReceived = new Decimal(localChannel.total_satoshis_received || 0);
				- valueSent = new Decimal(localChannel.total_satoshis_sent || 0);

			else if (localChannel.channel != null)
				- valueReceived = new Decimal(localChannel.channel.total_satoshis_received || 0);
				- valueSent = new Decimal(localChannel.channel.total_satoshis_sent || 0);


			if (valueReceived != null && (valueReceived > 0 || valueSent > 0))
				.text-end.fs-90
					if (valueReceived && valueReceived > 0)
						.text-success
							| +
							+btcValue(valueReceived)
					
					if (valueSent && valueSent > 0)
						.text-danger
							| -
							+btcValue(valueSent)
			else
				.text-end -

			if (nodeChannels)
				td.fit.text-end
					+btcValue(chan.capacity)

	else 
		td.fit.text-end
			+btcValue(chan.capacity)

	if (chan.channel_id)
		td.fit.text-end
			- let blockHeight = 0
			if (parsedChannelId && parsedChannelId.blockHeight)
				- blockHeight = parsedChannelId.blockHeight
			else
				- blockHeight = channelDescription.blockHeight

			+blockHeight(blockHeight)

			br
			if (!chan.close_type && (chan.last_update || localChannel))
				if (localChannel && chan.active)
					+date(fullNetworkDescription.channelsById[chan.channel_id].last_update)
				else
					+date(chan.last_update)
			else
				span -
	else 
		td.fit.text-end
			span -

	if (localChannel) 
		- let modal = `#localChannelModal-${localChannel_index}`
		if (sharedChannel)
			- modal = `#sharedChannelModal-${channelTableIndex}`

		td.text-end
			a.btn.btn-sm.btn-primary(href="javascript:void(0)" data-bs-toggle="modal" data-bs-target=(modal))
				i.fas.fa-file-lines

	